<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rokad Form</title>
    <link rel="stylesheet" href="forms.css">
    <link rel="stylesheet" href="../CSS/popup.css">

    <script src="https://kit.fontawesome.com/8d4098fe32.js" crossorigin="anonymous"></script>

</head>

<body>
    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close" onclick="closePopup()">&times;</span>
            <span>
                <span><i class="fas fa-info-circle"></i></span>
                <p id="popupmsg">This is a popup message!</p>
            </span>
        </div>
    </div>
    <header>
        <button type="button" id="cancel-btn" onclick="back()"><i class="fa-regular fa-circle-left"></i></button>
        <h1>Cashbook</h1>
        <button type="button" id="submit-btn" onclick="saveData()"><i class="fa-solid fa-check"></i></button>

    </header>
    <div id="forms_div">

    </div>
    <button id="Add_F_Btn">Add Form</button>
</body>
<script>

    let form_count = 0;
    let form_arr = [];

    let Add_F_Btn = document.getElementById("Add_F_Btn");


    Add_F_Btn.addEventListener("click", () => {
        let cform = document.createElement("form");
        form_count++;
        cform.id = "Form_id_" + form_count;
        form_arr.push(form_count);
        cform.classList.add("rokadForm");

        let d_value;

        if (form_count < 2) {
            d_value = "dnon";
        } else {
            d_value = "d";
        }

        cform.innerHTML = `
        <div class="r-form">
            <div class="h_div_info">
            <p class="${d_value}" id="Form_no_d">Form : ${form_count}</p>
            <button class="" id="delete_form_btn" onclick="delete_form(${form_count})">remove</button>
            </div>

            <h2>आय पक्ष</h2>
            <div class="rashi-cantainer">

                <div class="f-div flexc">
                    <label for="rokadDate">दिनांक</label>
                    <input type="date" id="rokadDate${form_count}">
                </div>
                <div class="f-div flexc">
                    <label for="AKMMKP">खाता पन्ना</label>
                    <input type="number" id="AKMMKP${form_count}">
                </div>
            </div>

            <div class="select-byore">
                <hr>
                <label for="" class="_17px">आय के ब्योरे</label>
                
                <div class="f-div flexc">
                    <label for="selectOptions1">किससे राशि प्राप्त</label>
                    <select id="selectOptions1${form_count}" class="selectbyore">
                        <option value=" ">विकल्प चुनें</option>

                        <option value="श्रीमान् मुख्य कार्यपालन अधिकारी महोदय">श्रीमान् मुख्य कार्यपालन अधिकारी महोदय
                            </option>
                        <option value="श्रम विभाग">श्रम विभाग</option>

                        <option value="पंचायतराज संचालनालय">पंचायतराज संचालनालय</option>
                        
                        <option value="ग्राम पंचायत">ग्राम पंचायत</option>

                        <option value="other" id="other">अन्य</option>
                    </select>
                </div>
                <div class="f-div flexc">
                    <label for="selectOptions2">किस मद से</label>
                    <select id="selectOptions2${form_count}" class="selectbyore">
                        <option value=" ">विकल्प चुनें</option>
                        <option value="15 वा वित्त">15 वा वित्त</option>
                        <option value="14 वा वित्त">14 वा वित्त</option>
                        <option value="विधायक निधि">विधायक निधि</option>
                        <option value="सांसद निधि">सांसद निधि</option>
                        <option value="संबंल योजना">संबंल योजना</option>
                        <option value="बैंक ब्याज">बैंक ब्याज</option>
                        <option value="ग्राम पंचायत निधि">ग्राम पंचायत निधि</option>

                        
                        <option value="जिला पंचायत निधि">जिला पंचायत निधि</option>
                        
                        <option value="जनपद पंचायत निधि">जनपद पंचायत निधि</option>
                        <option value="एस.बी.एम">एस.बी.एम</option>
                        <option value="जल कर">जल कर</option>
                        <option value="प्रकाश कर">प्रकाश कर</option>
                        <option value="भवन कर">भवन कर</option>
                        <option value="सफ़ाई कर">सफ़ाई कर</option>
                        <option value="बाज़ार शुल्क">बाज़ार शुल्क</option>
                        <option value="पशुहाट नीलामी">पशुहाट नीलामी</option>

                        <option value="other">अन्य मद</option>
                    </select>
                </div>
                
                <!-- <div class="f-div flexc byore">
            <label for="rokadParticular">आय के ब्यौरे</label>
            <input type="text" id="rokadParticular${form_count}">
            </div> -->
            <div class="f-div flexc">
                    <label for="selectOptions3">किस प्रयोजन हेतु</label>
                    <select id="selectOptions3${form_count}" class="selectbyore">
                        <option value=" ">विकल्प चुनें</option>
                        <option value="other">अन्य</option>
                        </select>
                </div>
                <hr>
            </div>
            <div class="rashi-cantainer">

                <div class="f-div">
                    <label for="rokadNagadRashi">नगद राशि</label>
                    <input type="text" id="rokadNagadRashi${form_count}">
                </div>
                <div class="f-div">
                    <label for="rokadBankRashi">बैंक राशि</label>
                    <input type="text" id="rokadBankRashi${form_count}">
                    </div>
                    </div>
                    <div class="f-div flexc byore dnone">
                <label for="rokadBajtLs">बजट लेखा शीर्ष</label>
                <input type="text" id="rokadBajtLs${form_count}">
            </div>
            <div class="f-div flexc byore">
                <label for="rokadSignature">हस्ताक्षर या टिप्पणी</label>
                <input type="text" id="rokadSignature${form_count}">
            </div>
            
        </div>
        <div class="b-form">

            <h2>भुगतान पक्ष</h2>
            <!-- <div class="f-div">
            <label for="bahiSNo">S.no</label>
            <input type="number" id="bahiSNo${form_count}">
        </div> -->
            <div class="rashi-cantainer">
                
                <div class="f-div">
                    <label for="bahiAKMMKP">खाता पन्ना</label>
                    <input type="number" id="bahiAKMMKP${form_count}">
                    </div>
                    <div class="f-div">
                        <label for="epono">E.P.O No.</label>
                        <input type="number" id="epono${form_count}">
                </div>
                </div>
                
                <div class="select-byore">
                    
                    <label for="" class="_17px">व्यय के ब्योरे</label>
                    
                    <div class="f-div">
                    <label for="bselectOptions1">वेंडर का नाम</label>
                    <select id="bselectOptions1${form_count}">
                        <option value=" ">विकल्प चुनें</option>
                        <option value="other">अन्य</option>
                        </select>
                        </div>
                        <div class="f-div flexc byore">
                            <label for="bahibillno">बिल क्रमांक</label>
                            <input type="text" id="bahibillno${form_count}">
                            </div>
                            <div class="f-div">
                                <label for="bselectOptions2">कार्य का नाम</label>
                    <select id="bselectOptions2${form_count}">
                        <option value=" ">विकल्प चुनें</option>
                        <option value="other">अन्य</option>
                    </select>
                    </div>

                <div class="f-div">
                    <label for="bselectOptions3">भुगतान प्रकार</label>
                    <select id="bselectOptions3${form_count}">
                        <option value="पीआरडी पोर्टल">पीआरडी पोर्टल</option>
                        <option value="ई ग्रामस्वराज पोर्टल">ई ग्रामस्वराज पोर्टल</option>
                        <option value="नगद">नगद राशि</option>
                        </select>
                </div>
                </div>

            <div class="rashi-cantainer">

                <div class="f-div">
                    <label for="bahiNagadRashi">नगद राशि</label>
                    <input type="text" id="bahiNagadRashi${form_count}">
                </div>
                <div class="f-div">
                    <label for="bahiBankRashi">बैंक राशि</label>
                    <input type="text" id="bahiBankRashi${form_count}">
                    </div>
                    </div>
                    <!-- <div class="f-div flexc byore">
                <label for="bahiBajtLs">बजट लेखा शीर्ष</label>
                <input type="text" id="bahiBajtLs${form_count}">
            </div> -->

            <div class="f-div">
                <label for="bahiBajtLs">बजट लेखा शीर्ष</label>
                <select id="bahiBajtLs${form_count}">
                    <option value="">विकल्प चुनें</option>
                    <option value="15 वा वित्त">15 वा वित्त</option>
                    <option value="14 वा वित्त">14 वा वित्त</option>
                    <option value="विधायक निधि">विधायक निधि</option>
                    <option value="सांसद निधि">सांसद निधि</option>
                    <option value="संबंल योजना">संबंल योजना</option>
                    <option value="बैंक ब्याज">बैंक ब्याज</option>
                    <option value="ग्राम पंचायत निधि">ग्राम पंचायत निधि</option>

                    
                    <option value="जिला पंचायत निधि">जिला पंचायत निधि</option>

                    <option value="जनपद पंचायत निधि">जनपद पंचायत निधि</option>
                    <option value="एस.बी.एम">एस.बी.एम</option>
                    <option value="जल कर">जल कर</option>
                    <option value="प्रकाश कर">प्रकाश कर</option>
                    <option value="भवन कर">भवन कर</option>
                    <option value="सफ़ाई कर">सफ़ाई कर</option>
                    <option value="बाज़ार शुल्क">बाज़ार शुल्क</option>
                    <option value="पशुहाट नीलामी">पशुहाट नीलामी</option>
                    <!-- <option value="other">अन्य मद</option>                     -->
                </select>
            </div>

            </div>

        `;

        document.getElementById("forms_div").appendChild(cform);
        loaddatavalues();
        loadoptions();
        console.log(form_arr);
    })

    Add_F_Btn.click();


    function delete_form(id) {
        let item_for_delete = document.getElementById("Form_id_" + id);
        item_for_delete.parentNode.removeChild(item_for_delete);

        let indexToRemove = form_arr.indexOf(id);

        // Check if the value exists in the array
        if (indexToRemove !== -1) {
            // Remove the value at the found index
            form_arr.splice(indexToRemove, 1);
        }

        console.log(form_arr);
    }


    document.addEventListener("DOMContentLoaded", function () {
        loadoptions();
    });

    function addChangeListener(selectElementId, id) {
        var selectElement = document.getElementById(selectElementId);
        selectElement.addEventListener("change", function () {
            var inputId = id + "input";
            var inputElement = document.getElementById(inputId);
            if (selectElement.value === "other") {
                var parentDiv = selectElement.parentElement;
                if (!inputElement) {
                    inputElement = document.createElement('input');
                    inputElement.id = inputId;
                    parentDiv.appendChild(inputElement);
                }
            } else {
                if (inputElement) {
                    inputElement.parentElement.removeChild(inputElement);
                }
            }
        });
    }

    function loaddatavalues() {
        console.log(form_count);

        for (let i = 0; i < form_arr.length; i++) {
            let av = form_arr[i];
            
            // Call the function for each select element
            addChangeListener("selectOptions1" + av, "AF" + av);
            addChangeListener("selectOptions2" + av, "AS" + av);
            addChangeListener("selectOptions3" + av, "AT" + av);

            //bahi

            addChangeListener("bselectOptions1" + av, "VF" + av);
            addChangeListener("bselectOptions2" + av, "VS" + av);
            addChangeListener("bselectOptions3" + av, "VT" + av);

        }

    }


    function loadoptions() {
        for (let ja = 0; ja < form_arr.length; ja++) {
            let j = form_arr[ja];

            var formCount1 = localStorage.getItem("AFCount");
            var formCount2 = localStorage.getItem("ASCount");
            var formCount3 = localStorage.getItem("ATCount");

            loadOptionsForSelect("selectOptions1" + j, "AF", formCount1);
            loadOptionsForSelect("selectOptions2" + j, "AS", formCount2);
            loadOptionsForSelect("selectOptions3" + j, "AT", formCount3);

            var VformCount1 = localStorage.getItem("VFCount");
            var VformCount2 = localStorage.getItem("VSCount");
            var VformCount3 = localStorage.getItem("VTCount");

            loadOptionsForSelect("bselectOptions1" + j, "VF", VformCount1);
            loadOptionsForSelect("bselectOptions2" + j, "VS", VformCount2);
            loadOptionsForSelect("bselectOptions3" + j, "VT", VformCount3);

            loadOptionsForSelect("bahiBajtLs" + j, "AS", formCount2);
        }

    }

    function loadOptionsForSelect(selectId, optionPrefix, formCount) {
        var selectElement = document.getElementById(selectId);

        var lastChild = selectElement.lastElementChild;

        for (var i = 1; i <= formCount; i++) {
            var formData = localStorage.getItem(optionPrefix + i);

            if (formData !== null && formData !== "") {
                // Check if the option value is not already present in the select element
                if (!selectElement.querySelector('option[value="' + formData + '"]')) {
                    var option = document.createElement("option");
                    option.value = formData;
                    option.textContent = formData;
                    selectElement.insertBefore(option, lastChild);
                }
            }
        }
    }

    function saveData() {

        let all_true = false;

        if(form_arr.length < 1){
            Add_F_Btn.click();
            alert("Please Add A Form!");
        }

        for (let ka = 0; ka < form_arr.length; ka++) {
            let k = form_arr[ka];

            var formDate = document.getElementById('rokadDate' + k);

            var formselectElement1 = document.getElementById('selectOptions1' + k);

            var formbselectElement1 = document.getElementById('bselectOptions1' + k);

            popupmsg = document.getElementById("popupmsg");

            if (formDate.value === "") {
                formDate.style.background = "rgba(86, 127, 202, 0.271)";
                formDate.focus();

                popupmsg.innerText = "कृपया दिनांक चुनें!"
                openPopup();
                all_true = false;
                break;

                // alert("please choose Date");
            }
            else if (formselectElement1.value === " " && formbselectElement1.value === " ") {
                // formselectElement1.style.background = "rgba(86, 127, 202, 0.271)";
                formselectElement1.focus();
                openPopup();

                popupmsg.innerText = "कृपया आय या व्याय के ब्योरे चुनें!"
                // alert("please choose aay ke byore ya vyay ke brore");

                all_true = false;
                break;

            } else {
                alert(" you choose options");
                // saveData1(k);
                all_true = true;

            }

            setInterval(() => {
                formDate.style.background = "white";

            }, 1000);
        }

        if (all_true) {
            for (let la = 0; la < form_arr.length; la++) {
                l = form_arr[la];
                saveData1(l);
            }
            back();
        }


    }

    function saveData1(form_count_n) {

        var valueselectElement1, valueselectElement2, valueselectElement3;

        var bvalueselectElement1, bvalueselectElement2, bvalueselectElement3;

        function handleSelectValue(selectElement, prefix) {
            if (selectElement.value === "other") {
                var count = localStorage.getItem(prefix + "Count");
                if (count === "" || count === null) {
                    count = 11;
                    localStorage.setItem(prefix + "Count", count);
                } else {
                    count++;
                    localStorage.setItem(prefix + "Count", count);
                }

                var input = document.getElementById(prefix + "input").value;
                localStorage.setItem(prefix + count, input);

                if (prefix === "AF") {
                    valueselectElement1 = input;
                }
                else if (prefix === "AS") {

                    valueselectElement2 = input;
                }
                else if (prefix === "AT") {

                    valueselectElement3 = input;
                }

                if (prefix === "VF") {
                    bvalueselectElement1 = input;
                }
                else if (prefix === "VS") {

                    bvalueselectElement2 = input;
                }
                else if (prefix === "VT") {

                    bvalueselectElement3 = input;
                }

                alert("if");

            } else {
                var valueOf = selectElement.value;
                // var valueOf = selectElement.innerText;
                alert("else");

                if (prefix === "AF") {
                    valueselectElement1 = valueOf;
                    console.log(valueselectElement1);
                }
                else if (prefix === "AS") {
                    valueselectElement2 = valueOf;
                    console.log(valueselectElement2);
                }
                else if (prefix === "AT") {
                    valueselectElement3 = valueOf;
                    console.log(valueselectElement3);
                }

                if (prefix === "VF") {
                    bvalueselectElement1 = valueOf;
                    console.log(bvalueselectElement1);
                }
                else if (prefix === "VS") {
                    bvalueselectElement2 = valueOf;
                    console.log(bvalueselectElement2);
                }
                else if (prefix === "VT") {
                    bvalueselectElement3 = valueOf;
                    console.log(bvalueselectElement3);
                }

            }
        }

        var selectElement1 = document.getElementById('selectOptions1' + form_count_n);
        handleSelectValue(selectElement1, "AF");

        var selectElement2 = document.getElementById('selectOptions2' + form_count_n);
        handleSelectValue(selectElement2, "AS");

        var selectElement3 = document.getElementById('selectOptions3' + form_count_n);
        handleSelectValue(selectElement3, "AT");


        var bselectElement1 = document.getElementById('bselectOptions1' + form_count_n);
        handleSelectValue(bselectElement1, "VF");

        var bselectElement2 = document.getElementById('bselectOptions2' + form_count_n);
        handleSelectValue(bselectElement2, "VS");

        var bselectElement3 = document.getElementById('bselectOptions3' + form_count_n);
        handleSelectValue(bselectElement3, "VT");




        // Get Rokad form values
        var rokadDate = document.getElementById('rokadDate' + form_count_n).value;
        // var rokadSNo = document.getElementById('rokadSNo').value;
        var AKMMKP = document.getElementById("AKMMKP" + form_count_n).value;
        // var rokadParticular = document.getElementById('rokadParticular').value;
        var rokadNagadRashi = document.getElementById('rokadNagadRashi' + form_count_n).value;
        var rokadBankRashi = document.getElementById('rokadBankRashi' + form_count_n).value;
        var rokadBajtLs = document.getElementById('rokadBajtLs' + form_count_n).value;
        var rokadSignature = document.getElementById('rokadSignature' + form_count_n).value;

        var selectElement2 = document.getElementById('selectOptions2' + form_count_n).value;
        var selectElement3 = document.getElementById('selectOptions3' + form_count_n).value;

        // Get Bahi form values
        // var bahiSNo = document.getElementById('bahiSNo').value;
        var bahiAKMMKP = document.getElementById("bahiAKMMKP" + form_count_n).value;
        var epono = document.getElementById("epono" + form_count_n).value;
        // var bahiParticular = document.getElementById('bahiParticular').value;
        var bahiNagadRashi = document.getElementById('bahiNagadRashi' + form_count_n).value;
        var bahiBankRashi = document.getElementById('bahiBankRashi' + form_count_n).value;
        var bahiBajtLs = document.getElementById('bahiBajtLs' + form_count_n).value;

        var bahibillno = document.getElementById('bahibillno' + form_count_n).value;
        // var bselectElement1 = document.getElementById('bselectOptions1').value;
        // var bselectElement2 = document.getElementById('bselectOptions2').value;
        // var bahiSignature = document.getElementById('bahiSignature').value;

        // Get value from local storage for both forms
        var rbFormCount = parseInt(localStorage.getItem("rbFormCount")) || 0;
        rbFormCount = ++rbFormCount;

        let rbDatarbFormCount = 'rbData' + rbFormCount


        if (valueselectElement1 === " ") {
            var rokadParticular = "";
        } else {
            var rokadParticular = valueselectElement1 + " से " + valueselectElement2 + " मद " + valueselectElement3 + " की राशि प्राप्त"
        }

        if (bvalueselectElement1 === " ") {
            var bahiParticular = "";
        } else {
            var bahiParticular = bvalueselectElement1 + " से बिल क्रमांक " + bahibillno + " के अनुसार " + bvalueselectElement2 + " हेतु बिल अनुसार " + bvalueselectElement3 + " से राशि का भुगतान किया गया";
        }



        // Create objects to store the form data
        var rbFormData = {
            'Date': rokadDate,
            // 'r_S.no': rokadSNo,
            'r_AKMMKP': AKMMKP,
            'r_Particular': rokadParticular,
            'r_Nagad Rashi': rokadNagadRashi,
            'r_Bank Rashi': rokadBankRashi,
            // 'r_Bajt LS': rokadBajtLs,
            'r_Bajt LS': valueselectElement2,
            'r_Signature': rokadSignature,
            'r_AFO': valueselectElement1,
            'r_ASO': valueselectElement2,
            'r_ATO': valueselectElement3,
            // 'b_S.no': bahiSNo,
            'b_AKMMKP': bahiAKMMKP,
            'b_E.P.N No.': epono,
            'b_Particular': bahiParticular,
            'b_Nagad Rashi': bahiNagadRashi,
            'b_Bank Rashi': bahiBankRashi,
            'b_Bajt LS': bahiBajtLs,
            'bahibillno': bahibillno,
            'b_fo': bvalueselectElement1,
            'b_so': bvalueselectElement2,
            'b_to': bvalueselectElement3,
            // 'b_Signature': bahiSignature
            'Form_Id': rbDatarbFormCount,
        };

        // Convert the objects to JSON strings
        var rbFormDataJSON = JSON.stringify(rbFormData);

        // Store the JSON strings and form counts in local storage
        localStorage.setItem('rbFormCount', rbFormCount);

        var rbDataKey = "rbData" + rbFormCount;

        localStorage.setItem(rbDataKey, rbFormDataJSON);
        localStorage.setItem("reloadhome3", 0);

        alert('Data saved to local storage!');
    }

    function back() {
        window.location.href = "../home.html";
    }

</script>
<script src="../JavaScript/popup.js">
</script>

</html>